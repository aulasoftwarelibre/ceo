{% extends "base.html.twig" %}

{% block body %}

    {% if app.user.collective is empty %}
    <div class="ui floating warning icon message">
        <i class="exclamation icon"></i>
        <div class="content">
          <div class="header">
            Debes registrarte antes de seguir.
          </div>
          Completa el siguiente formulario.
        </div>
    </div>
    {% endif %}

    <h2 class="ui header">Editar perfil

    <div class="ui divider"></div>

    <div class="ui grid">
        <div class="two column">
            {{ form_start(form, {method: 'POST', action: path('profile_edit')}) }}
            {{ form_widget(form) }}

            <div class="ui divider"></div>

            {#<button class="ui button" type="submit">Enviar</button>#}

            <div class="ui submit button">Guardar</div>

            {{ form_end(form) }}
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script>
        $('select')
            .dropdown({ fullTextSearch: true })
        ;
        $.fn.form.settings.rules.collective = function(value, required) {
            var collective = $('.ui.form').form('get value', 'profile[collective]');

            return collective !== required || value;
        };

        $('.ui.form')
            .form({
                on: 'blur',
                inline : true,
                fields: {
                    profile_firstname: {
                        identifier: 'profile_firstname',
                        rules: [{
                            type: 'empty',
                            prompt: 'Indica tu nombre'
                        }]
                    },
                    profile_lastname: {
                        identifier: 'profile_lastname',
                        rules: [{
                            type: 'empty',
                            prompt: 'Indica tus apellidos'
                        }]
                    },
                    profile_collective: {
                        identifier: 'profile_collective',
                        rules: [{
                            type: 'empty',
                            prompt: 'Indica tu colectivo'
                        }]
                    },
                    profile_degree: {
                        identifier: 'profile_degree',
                        depends: 'profile_collective',
                        rules: [{
                            type: 'collective[student]',
                            prompt: 'Si eres alumno indica tus estudios'
                        }]
                    },
                    profile_year: {
                        identifier: 'profile_year',
                        depends: 'profile_collective',
                        rules: [{
                            type: 'collective[student]',
                            prompt: 'Indica el a√±o de ingreso a tus estudios actuales'
                        }]
                    }
                }
            })
        ;
    </script>
{% endblock %}